# ADR-0008: 対話生ログの永続保存システム確立

## Status
- **提案日**: 2025-10-29
- **状態**: Accepted
- **決定者**: human + Claude Code

## Context

### 背景

**問題の発見:**
- VS Code (GitHub Copilot) での長期対話において、トークン上限（1,000,000）に近づくと自動要約が発生
- 要約によって**生ログが失われる**（対話の詳細・ニュアンス・感情・散漫プロセスが消失）
- Web UIでの頻繁なスレッド分割から移行したが、逆に「長期使用による情報喪失」リスクが浮上

**生ログの価値:**
- 散漫のパターン分析（HSS型HSP特有のプロセス）
- 感情の流れ・EBI測定データの時系列記録
- 意思決定の真の理由（暗黙の前提を含む）
- ツール実行結果のスナップショット
- AGENT.mdと同等の一次情報源

### 検討した選択肢

1. **選択肢A: 何もしない（要約に任せる）**
   - メリット: 手間ゼロ
   - デメリット: 貴重な一次情報が永遠に失われる

2. **選択肢B: 手動コピペで断片的に保存**
   - メリット: 今すぐ開始可能
   - デメリット: 継続性が低い、構造化されない

3. **選択肢C: 3層保存アーキテクチャ確立**（採用）
   - メリット: 体系的・持続可能・自動化可能
   - デメリット: 初期投資（スクリプト作成）が必要

## Decision

**3層保存アーキテクチャを確立し、対話生ログを永続保存する。**

### アーキテクチャ詳細

```
Layer 1: リアルタイム記録（会話中）
└─ VS Code Copilot Chat（揮発性）

Layer 2: 日次保存（毎日終わり）
└─ nullvariant-writings/docs/log/YYYY/MM/YYYY-MM-DD_*.md
   ├─ 対話生ログ（重要な会話全文）
   ├─ 決定記録（ADR未満の小決定）
   ├─ 感情・EBIログ（ペルソナ状態推移）
   └─ コマンド出力スナップショット

Layer 3: 永続保存（週次・重要時）
└─ Git commit + push（nullvariant-writings）
   └─ Dropbox同期による二重バックアップ
```

### 保存フォーマット標準化

```markdown
---
date: YYYY-MM-DD
topic: [トピック]
context: [文脈]
decisions:
  - [決定事項]
emotions:
  - [ペルソナ]: [感情ID] ([状態])
related:
  - [ADR番号、ファイルパス]
---

# 対話ログ本文
...
```

### 実装フェーズ

**Phase 1: 手動運用（即時開始）**
- 毎日の重要対話を手動で `docs/log/` に保存
- Frontmatter標準化
- Git commit習慣化

**Phase 2: 半自動化（2週間以内）**
- `scripts/archive_conversation.py` 作成
- 自動Frontmatter生成
- EBI測定結果の自動記録

**Phase 3: 完全自動化（1ヶ月以内）**
- VS Code拡張との連携検討
- トークン使用率監視アラート（60%で警告）
- 週次レビューレポート自動生成

## Consequences

### ✅ メリット

1. **一次情報の完全保護**
   - 散漫・感情・決定プロセスが永久保存される
   - 後からパターン分析が可能（HSS型HSP研究データ）

2. **トレーサビリティ向上**
   - 「なぜそう判断したか」が失われない
   - 暗黙の前提も記録される

3. **AI訓練データとしての価値**
   - 次世代AIエージェントへの引き継ぎ資料
   - 高解像度の人間-AI協働プロセス記録

4. **自己理解の深化**
   - 時系列でEBIパターンを分析
   - 成長の軌跡を可視化

5. **セッション断絶への対処**
   - 新しいセッション開始時、過去ログを参照して文脈復元
   - 「前回の続き」が容易

### ⚠️ デメリット

1. **日次作業の発生**
   - 毎日5分の保存作業（Phase 1）
   - Phase 2以降で軽減

2. **ストレージ消費**
   - 生ログは圧縮されないため容量大
   - 対策: Dropbox容量は十分、月次で古いログを圧縮

3. **プライバシー管理**
   - 生ログには個人的な思考が含まれる
   - 対策: nullvariant-writingsはprivateリポジトリ

### 📋 TODO

**即時（Phase 1）:**
- [x] ADR-0008作成
- [ ] 今日の対話ログを保存（2025-10-29_生ログ保存システム検討.md）
- [ ] Frontmatterテンプレート作成
- [ ] 日次保存ルーチンの習慣化

**2週間以内（Phase 2）:**
- [ ] `scripts/archive_conversation.py` 作成
- [ ] 自動Frontmatter生成機能
- [ ] EBI測定結果の自動記録
- [ ] トークン使用率監視スクリプト

**1ヶ月以内（Phase 3）:**
- [ ] 週次レビューレポート自動生成
- [ ] VS Code拡張連携検討
- [ ] 月次ログ圧縮・アーカイブ自動化

**継続的:**
- [ ] 毎日: 重要対話の保存
- [ ] 毎週: 週次ログ作成
- [ ] 毎月: 月次レビュー・パターン分析

## Related

### 関連するファイル
- `nullvariant-writings/docs/log/` - 保存先ディレクトリ
- `scripts/archive_conversation.py` - 自動保存スクリプト（Phase 2で作成）
- `.github/copilot-instructions.md` - AI向けガイドライン
- `content/ja/AGENT.md` - 参照元OS仕様書

### 関連する ADR
- [ADR-0007](20251028_0007_changelogsディレクトリのnullvariant-w_architecture.md) - nullvariant-writingsへのコンテンツ移行（本ADRもその延長線上）

### 対話ログ参照
- `nullvariant-writings/docs/log/2025/10/2025-10-28_命の使い方の本質.md` - 生ログ保存の価値を認識した対話
- `nullvariant-writings/docs/log/2025/10/2025-10-28_changelogジレンマと散漫メモ.md` - 散漫プロセスの記録例

---

**Status**: Accepted  
**実装開始**: 即時（Phase 1手動運用）  
**完全実装目標**: 2025-11-29（1ヶ月以内）
